const ErrorDuration=3e3;function texareaResizer(e){const t=document.querySelectorAll(".company__email-text, .insert-form__string");if(0!==t.length)for(let o of t)o.setAttribute("style","height:"+o.scrollHeight+"px;overflow-y:hidden;"),o.addEventListener("input",n,!1),"doIt"===e&&(o.style.height="auto",o.style.height=o.scrollHeight+"px");function n(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}}function warnRemover(e){setTimeout(()=>{e.innerHTML=""},ErrorDuration)}function emailHandler(){const e=document.querySelectorAll(".popup-link"),t=document.querySelector("body"),n=document.querySelector("header"),o=document.querySelector("footer"),l=document.querySelectorAll("section"),r=document.querySelectorAll(".lock-padding"),c=document.querySelectorAll(".lock-margin"),a=document.querySelectorAll(".close-popup");let i=!0;const s=800;let u=document.querySelectorAll(".company");if(e.length>0)for(let t of e)t.addEventListener("click",function(e){e.preventDefault();const n=t.getAttribute("data-popup-id");d(document.getElementById(n))});if(a.length>0)for(let e=0;e<a.length;e++){const t=a[e];t.addEventListener("click",e=>{e.preventDefault(),m(t.closest(".popup"))})}function d(e){if(e&&i){const a=document.querySelector(".popup.popup-active");a?m(a,!1):function(){const e=window.innerWidth-document.querySelector(".main").offsetWidth+"px";if(r.length>0)for(let t of r)t.style.paddingRight=e;if(c.length>0)for(let t of c)t.style.marginRight=e;if(t.classList.add("lock"),l.length>0)for(let t of l)t.style.paddingRight=e;n.style.paddingRight=e,o.style.paddingRight=e,i=!1,setTimeout(function(){i=!0},s)}(),e.classList.add("popup-active"),e.addEventListener("click",function(e){e.preventDefault(),e.target.closest(".popup__content")||m(e.target.closest(".popup"))})}}function m(e,a){a=void 0===a||a,i&&(e.classList.remove("popup-active"),a&&(setTimeout(function(){if(r.length>0)for(let e of r)e.style.paddingRight="0px";if(c.length>0)for(let e of c)e.style.marginRight="0px";if(t.classList.remove("lock"),l.length>0)for(let e of l)e.style.paddingRight="0px";n.style.paddingRight="0px",o.style.paddingRight="0px"},s),i=!1,setTimeout(function(){i=!0},s)))}if(document.addEventListener("keydown",function(e){if(27===e.which){console.log(!0);const e=document.querySelector(".popup.popup-active");if(null===e)return;m(e)}}),0===u.length)return;let p=function(e){let t=function(e){let t=e.querySelector(".company__email-text").value,n=e.querySelector(".company__email").innerHTML,o="";return n.length>0&&(o+="1="+t+"&2="+n+"&3=my sender&4=отправляю вам свежие предложения&5=mail@example.com"),o}(e),n=new XMLHttpRequest;n.open("POST","mail/mail.php"),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.onload=function(){if("success"===this.response){console.log("form sent successfully");document.getElementById("popupEmailSuccess");const t=e.querySelector(".company__card-error");t.innerHTML="письмо успешно отправлено.",warnRemover(t),e.querySelector(".company__email-text").value="",texareaResizer("doIt")}else{console.log("some error occurred");document.getElementById("popupEmailError");const t=e.querySelector(".company__card-error");t.innerHTML="произошла ошибка при попытке отправить почту. попытайтесь снова позже.",warnRemover(t)}},n.send(t)};function y(e){const t=e.querySelector(".company__email-text"),n=e.querySelector(".company__card-error");if(t.value.length>0)return!0;n.innerHTML="нет текста для отправки!",warnRemover(n)}for(let e=0;e<u.length;e++){u[e].querySelector(".company__send-email").addEventListener("click",function(t){t.preventDefault(),y(u[e])&&p(u[e])})}}$(()=>{let e=document.querySelector(".insert-form__string"),t=document.querySelector(".insert-form__warn"),n=document.querySelector(".add-company__error"),o=[];function l(e){setTimeout(()=>{e.innerHTML=""},ErrorDuration)}function r(){const e=document.querySelectorAll(".company");if(e.length>0)for(let t of e){t.querySelector(".company__remove").addEventListener("click",e=>{e.preventDefault(),t.remove(),console.log("company deleted")})}}function c(){const e=document.querySelectorAll(".tag");if(e.length>0)for(let t of e){t.querySelector(".tag__button").addEventListener("click",e=>{e.preventDefault(),t.remove()})}}function a(){const e=document.querySelectorAll(".company");if(e.length>0)for(let t of e){t.querySelector(".company__add-button").addEventListener("click",e=>{e.preventDefault();const n=t.querySelector(".company__add-button");n.classList.remove("active");const o=t.querySelector(".company__add-tag");o.classList.add("active"),o.querySelector(".company__add-tag-button").addEventListener("click",e=>{e.preventDefault(),n.classList.add("active"),o.classList.remove("active");const l=o.querySelector(".company__add-input"),r=t.querySelector(".company__bot-left");if(l.value){const e=`\n                            <div class="company__tag tag">\n                                <div class="tag__text">${l.value}</div>\n                                <button class="tag__button">X</button>\n                            </div>\n                            `;l.value="",r.innerHTML+=e,c()}})})}}function i(){const e=document.querySelectorAll("textarea");if(0!==e.length)for(let t of e)t.addEventListener("keydown",function(e){if("Tab"==e.key){e.preventDefault();let t=this.selectionStart,n=this.selectionEnd;this.value=this.value.substring(0,t)+"\t"+this.value.substring(n),this.selectionStart=this.selectionEnd=t+1}})}document.querySelector(".insert-form__button").addEventListener("click",n=>{n.preventDefault(),e.value?(!function(){let n=document.querySelectorAll(".company"),r=0;n.length>0?(n.forEach(function(e,t,n){let l=(o=n[t]).querySelectorAll(".tag__text");l.length>0&&l.forEach(c)}),0==r?(t.innerHTML="совпадений не обнаружено",l(t)):r>0&&(e.value="",t.innerHTML=`обнаружено ${r} совпадений`,l(t))):(t.innerHTML="не добавлено ниодной компании",l(t));function c(t,n,l){const c=l[n];if(e.value.indexOf(c.innerHTML)+1){r++;const t=o.querySelector(".company__email-text");t.value=e.value}}}(),texareaResizer("doIt")):(t.innerHTML="вы ничего не ввели",l(t))}),i(),c(),a(),function(){const e=document.querySelector(".add-company"),t=e.querySelector(".add-company__button"),o=e.querySelector(".add-company__comp-name"),s=e.querySelector(".add-company__text"),u=e.querySelector(".add-company__comp-email"),d=document.querySelector(".parser__middle-section"),m=e.querySelector(".add-company__tags");let p="";t.addEventListener("click",e=>{if(e.preventDefault(),!o.value)return n.innerHTML='поле "компания" обязательно к заполнению!',void l(n);if(!u.value)return n.innerHTML='поле "Email компании" обязательно к заполнению!',void l(n);if(u.value){let e=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;if(!u.value.match(e))return n.innerHTML="неверный формат Email",void l(n)}if(m.value.length>0){let e=m.value.split(/,\s*/);if(e.length>0)for(let t of e)t&&(p+=`<div class="company__tag tag">\n    <div class="tag__text">${t}</div>\n    <button class="tag__button">X</button>\n</div>\n`)}let t=document.createElement("form");t.classList.add("parser__company","company");let y=`\n            <form class="parser__middle-section company">\n                <div class="company__top">\n                    <div class="company__data">\n                        <div class="company__name">${o.value}</div>\n                        <div class="company__email">${u.value}</div>\n\n                    </div>\n                    <div class="company__text-container">\n                        <textarea class="company__email-text">${s.value}</textarea>\n                        <div class="company__card-error error"></div>\n                    </div>\n                    <div class="company__buttons">\n                        <button class="company__remove">удалить</button>\n                        <button class="company__send-email" type="submit">отправить eMail</button>\n                    </div>\n                </div>\n                <div class="company__bottom">\n                    <div class="company__bot-left">${p}\n                    </div>\n                    <div class="company__bot-right">\n                        <button class="company__add-button active">добавить тег</button>\n                        <div class="company__add-tag">\n                            <input type="text" class="company__add-input">\n                            <button class="company__add-tag-button">V</button>\n                        </div>\n                    </div>\n                </div>\n        </form>\n            `;t.innerHTML=y,d.appendChild(t),o.value="",u.value="",s.value="",m.value="",p="",r(),c(),a(),texareaResizer("doIt"),i(),emailHandler()})}(),r(),texareaResizer(),emailHandler()}),$(()=>{$(window).scroll(()=>{0!=$(this).scrollTop()?$("#jumpBtn").fadeIn():$("#jumpBtn").fadeOut()}),$("#jumpBtn").click(()=>{$("body,html").animate({scrollTop:0},800)})}),Element.prototype.closest||(Element.prototype.closest=function(e){let t=this;for(;t;){if(t.matches(e))return t;t=t.parentElement}return null}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector);